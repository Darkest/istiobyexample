{"componentChunkName":"component---src-templates-example-js","path":"/authorization/","webpackCompilationHash":"4c97b8867ce8cc5e8d2c","result":{"data":{"site":{"siteMetadata":{"title":"Istio By Example","author":"Megan O'Keefe"}},"markdownRemark":{"id":"14f14bda-5553-510f-b138-8179768eb4c0","excerpt":"Authentication means verifying the identity of a client. Authorization, on the other hand, verifies the permissions of that client, or: “can this service do…","html":"<p>Authentication means verifying the identity of a client. <strong>Authorization</strong>, on the other hand, verifies the permissions of that client, or: “can this service do what they’re asking to do?”</p>\n<p>Kubernetes supports authorization through <strong>role-based access control</strong> (<a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#api-overview\">RBAC</a>). In this model, you can map a <strong>role</strong> (a set of permissions) to a <strong>role binding</strong> (who exactly has these permissions?).</p>\n<p><a href=\"https://istio.io/docs/concepts/security/#authorization\">Istio uses RBAC</a> to allow you to set authorization policies between services in your cluster. Let’s see how.</p>\n<p>Here, the <em>ShoeStore</em> application is deployed to the <code class=\"language-text\">default</code> Kubernetes namespace. There are three services, and all speak plain HTTP:</p>\n<ol>\n<li><code class=\"language-text\">shoes</code>: exposes an API for all the shoes in the store</li>\n<li><code class=\"language-text\">users</code>: stores purchase history</li>\n<li><code class=\"language-text\">inventory</code>: loads new shoe models into <code class=\"language-text\">shoes</code>.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4728ec40e0fa8a81c959ef33674b4d45/c51b9/rbac.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.86885513637106%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAJnKAACZygHjkaQiAAAB/UlEQVQoz4WSW2+bQBCF8/9/Tp8q9aVSValprdhJcwM7EMdgMDbYYMxtd+frBnKxo6odaSSGmTlzduac8WIiwrE9x6LVSa7SNYsmwK89JuUV08qlMNvXjt7PjhvEGGS/Q/IUs5wjVTmUiRkGYFBGeNpXXGcBSa1Z7yHeC+sSbIqzvtA29IBNhXEu0c4E499B1/LRniuTULH96eOGBU4K043wO7bj5IUhR6RN6GEe3SHWuv8XtSue6oBSlTx0IaPRGJYl5+e3OLkmysFZvwCaQ4HZJph8Y5d0gGyNmd8zqzyCNmKUXzAuLnEPM7IupdAN86eCehwT+DW+BXvM4HbFAKiXPjrykSRgFk2Iv12RXI94qGbEdUyLICfHgrQSskNHZncYF5ah9c3BDDvU4QOSLqFcsfv0mTrIKS98+DWyY6cQ2NwiwGSZPZg9knrea4G0lpoU1i09Y3M66W/RA+qlh97Yprt7mnFEd7fA7FJbu0VmHuK4yHiCnI+QKEBlMdUPy36R0qgpbRvSNF6vhPcd7jaYtsQUOeZgpWPUqS67zrLq7HtXNF++0rpb6vuIqhjTqaUFnQ+A/MN6SZlXDb4rQdFQ3yS0fmi/N6hubQEfhycPOvy7v+n/OK5rjHdrhe9iLr6j4ylKtmhd/J/hB7oDS2VXEa+RGwe8ObT6pOwPV7adVod1XP4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"shoes rbac\"\n        title=\"shoes rbac\"\n        src=\"/static/4728ec40e0fa8a81c959ef33674b4d45/b9e4f/rbac.png\"\n        srcset=\"/static/4728ec40e0fa8a81c959ef33674b4d45/cf440/rbac.png 148w,\n/static/4728ec40e0fa8a81c959ef33674b4d45/d2d38/rbac.png 295w,\n/static/4728ec40e0fa8a81c959ef33674b4d45/b9e4f/rbac.png 590w,\n/static/4728ec40e0fa8a81c959ef33674b4d45/f9b6a/rbac.png 885w,\n/static/4728ec40e0fa8a81c959ef33674b4d45/2d849/rbac.png 1180w,\n/static/4728ec40e0fa8a81c959ef33674b4d45/c51b9/rbac.png 6123w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>We want to authorize <code class=\"language-text\">inventory</code> to be able to <code class=\"language-text\">POST</code> new inventory to <code class=\"language-text\">shoes</code>, but not be able to access <code class=\"language-text\">users</code> at all. To do this, we will need three Istio resources.</p>\n<p>First, we need to enable authorization for the <code class=\"language-text\">default</code> Kubernetes namespace:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"rbac.istio.io/v1alpha1\"</span>\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRbacConfig\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> default\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ON_WITH_INCLUSION'</span>\n  <span class=\"token key atrule\">inclusion</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">namespaces</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"default\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Second, we’ll define our <code class=\"language-text\">ServiceRole</code>, the abstract set of permissions to <code class=\"language-text\">POST</code> data to the <code class=\"language-text\">shoes</code> service:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"rbac.istio.io/v1alpha1\"</span>\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceRole\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shoes<span class=\"token punctuation\">-</span>user\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"shoes.default.svc.cluster.local\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">methods</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Lastly, we’ll bind this abstract <code class=\"language-text\">shoes-user</code> role to a concrete set of <code class=\"language-text\">subjects</code> — in this case, any request that has the <code class=\"language-text\">hello:world</code> HTTP header.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"rbac.istio.io/v1alpha1\"</span>\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceRoleBinding\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shoes<span class=\"token punctuation\">-</span>user<span class=\"token punctuation\">-</span>binding\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n      request.headers<span class=\"token punctuation\">[</span>hello<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"world\"</span>\n  <span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceRole\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"shoes-user\"</span></code></pre></div>\n<p>From here, the <code class=\"language-text\">inventory</code> service can only make requests to <code class=\"language-text\">shoes</code> with the <code class=\"language-text\">hello:world</code> header, and the <code class=\"language-text\">users</code> service is still locked down. This is because RBAC is on, but we haven’t assigned any <code class=\"language-text\">ServiceRoles</code> to access the <code class=\"language-text\">users</code> service.</p>\n<p>To learn more:</p>\n<ul>\n<li><a href=\"https://istio.io/docs/tasks/security/authz-http/#step-2-allowing-access-to-the-details-and-reviews-services\">Istio Authorization with Pod service accounts</a> (requires mutual TLS)</li>\n<li><a href=\"https://istio.io/blog/2018/istio-authorization/#using-authenticated-client-identities\">End-user authorization</a> through JWT claims</li>\n<li><a href=\"https://istio.io/docs/tasks/security/authz-http/#enforcing-namespace-level-access-control\">Namespace-level authorization</a></li>\n</ul>","frontmatter":{"title":"authorization","date":"May 01, 2015"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/authorization/","previous":{"fields":{"slug":"/external-services/"},"frontmatter":{"title":"external services"}},"next":{"fields":{"slug":"/traffic-mirroring/"},"frontmatter":{"title":"traffic mirroring"}}}}}