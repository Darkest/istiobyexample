{"componentChunkName":"component---src-templates-example-js","path":"/external-services/","webpackCompilationHash":"4c97b8867ce8cc5e8d2c","result":{"data":{"site":{"siteMetadata":{"title":"Istio By Example","author":"Megan O'Keefe"}},"markdownRemark":{"id":"1fa61444-1ed8-5101-9334-e53f1b1a8f9f","excerpt":"A service mesh often spans one environment— for instance, one Kubernetes cluster. And together, all the connected services in that environment form the…","html":"<p>A <a href=\"https://istio.io/docs/concepts/what-is-istio/#what-is-a-service-mesh\">service mesh</a> often spans one environment— for instance, one Kubernetes cluster. And together, all the connected services in that environment form the management domain of that mesh, from which you can view metrics and set policies.</p>\n<p>But what if you are also running services <em>outside</em> the cluster, or you depend on external APIs?</p>\n<p>Have no fear. Istio provides a resource called a <a href=\"https://istio.io/docs/concepts/traffic-management/#service-entries\"><code class=\"language-text\">ServiceEntry</code></a> that lets you logically bring external services into your mesh — even services you don’t own.</p>\n<p>When you create a ServiceEntry for an external hostname, you can view metrics and traces reaching all the way to that external service. You can even set traffic policies like <a href=\"/retry/\">retry logic</a> on those external services. Adding <code class=\"language-text\">ServiceEntries</code> effectively expands the reach of your Istio management domain. Let’s see an example.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1f1887d8d4790fe64dd6616441e58b2b/bafa1/currency.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.16852039096731%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAJnKAACZygHjkaQiAAABX0lEQVQoz5WSW04DMQxFZ/fsgB++kdgAbIBVgBBFPNoymWcn47xzsTO0aqvygaUrOx8+uXFc4Z+Rcz7k43ofVYyA8/lPWZfx8Jhxe58RIk5g51BR9d1kbBtg2AH9uKgTDUuteuD6Dri6ydAkzfmi6wNQmq33sEmDwsR5hosElwzXVABkM+pWGhdA4GcZ50pfPgNXxdGsoUhhMCMa02L3vIF5UVx3+JzWWPVb1L00B5Cz7NQsUGsxTmyC4Skt6ALsf4FjnFGrDWilEFY9uqbGB63xNXZ4UxqjH/E+bKCaBkopeAbNWhcgWYfIlxwcttRAe8kt6FXBPSmQmcutMSzzlEj8rJmdEcuFUJyKBCi5zJCch4kaMwOJXdpAPJ8ZhufICPiQ0Q7Lh8gcZVYppQLwYVHkc3ly02dMbMS4xLecylhZHWCn98DTnbv02xU75TXJ6GVt9hqPlUsWl8cOL0niB08BC/8esVvwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"external currency service\"\n        title=\"external currency service\"\n        src=\"/static/1f1887d8d4790fe64dd6616441e58b2b/b9e4f/currency.png\"\n        srcset=\"/static/1f1887d8d4790fe64dd6616441e58b2b/cf440/currency.png 148w,\n/static/1f1887d8d4790fe64dd6616441e58b2b/d2d38/currency.png 295w,\n/static/1f1887d8d4790fe64dd6616441e58b2b/b9e4f/currency.png 590w,\n/static/1f1887d8d4790fe64dd6616441e58b2b/f9b6a/currency.png 885w,\n/static/1f1887d8d4790fe64dd6616441e58b2b/2d849/currency.png 1180w,\n/static/1f1887d8d4790fe64dd6616441e58b2b/bafa1/currency.png 5934w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>Here, we’re running a global store website with a <code class=\"language-text\">currency</code> service, responsible for converting product prices based on a user’s locality. We rely on an third-party currency conversion API, the <a href=\"https://www.ecb.europa.eu/stats/policy_and_exchange_rates/euro_reference_exchange_rates/html/index.en.html\">European Central Bank</a>, to provide realtime exchange rates.</p>\n<p>We want to set a 3-second timeout on all calls from services inside the mesh to this external API. We’ll need two Istio resources to do this.</p>\n<p>First, a <code class=\"language-text\">ServiceEntry</code>, which logically adds the European Central Bank’s hostname, <code class=\"language-text\">ecb.europa.eu</code>, to the mesh:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.istio.io/v1alpha3\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceEntry\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> currency<span class=\"token punctuation\">-</span>api\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> www.ecb.europa.eu\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> HTTP\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https\n    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> HTTPS</code></pre></div>\n<p>Second, a <code class=\"language-text\">VirtualService</code> traffic rule, to set a timeout for calls to the API:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.istio.io/v1alpha3\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> VirtualService\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> currency<span class=\"token punctuation\">-</span>timeout\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> www.ecb.europa.eu\n  <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> 3s\n    <span class=\"token key atrule\">route</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> www.ecb.europa.eu\n        <span class=\"token key atrule\">weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></code></pre></div>\n<p>Once we create a ServiceEntry for the currency API, we can automatically see <code class=\"language-text\">ecb.europa.eu</code> in our <a href=\"https://istio.io/docs/tasks/telemetry/kiali/\">Kiali service graph</a> (and instantly know <em>who</em>’s calling it):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/74cae8deb37ee425ce2ccda62a758c27/b4b41/servicegraph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.52505609573672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiklEQVQoz5VS7U7CQBDkUaBAKVYRsCKK0RdX30ESFPhhNJG2GBIjAr2PtuPtQiuC/vCayW4ve7Mzmy2UbQf17jXanodSyTIooVgswrIsRrlcRqVSQbVaZVBu2zaDcsdxGLVaDa7rouC2Oqi3ztDq9HBze4f7fh+DwQDj8Rij0QjD4ZCR5RR377dRaJ72YLstUHx6foFOASEElFKI4xj/PUzoNjtodi7xMHrE22yK+eecMQl8jkSstWZkjbK7LM+wJjS2G945Xic+VKKxUksIHeFjtYDUEqn5kiTJVaQp/acc9xQSkdPwDOEFgjDMH8SJ6ZjGULHkXEjBCpI04VwpzXWkmJolm5wJD9tdY7kHPwiYMFNDj4lQaLGnJN001nptld6wZSIjtLtX8P1vwm07kVwhNLNd8AgEprMZFsslN5RS8ixzy7WjE1QOmjg2swyC8IfCnNREaezo3LJEZDaByKJovRFUSyjQ/Kq0Nmw53FP42+CzowxhOHs3m7DI6/4k3CbLuu9ib67m7gtrQ+GdPFf8hwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"service graph\"\n        title=\"service graph\"\n        src=\"/static/74cae8deb37ee425ce2ccda62a758c27/b9e4f/servicegraph.png\"\n        srcset=\"/static/74cae8deb37ee425ce2ccda62a758c27/cf440/servicegraph.png 148w,\n/static/74cae8deb37ee425ce2ccda62a758c27/d2d38/servicegraph.png 295w,\n/static/74cae8deb37ee425ce2ccda62a758c27/b9e4f/servicegraph.png 590w,\n/static/74cae8deb37ee425ce2ccda62a758c27/f9b6a/servicegraph.png 885w,\n/static/74cae8deb37ee425ce2ccda62a758c27/2d849/servicegraph.png 1180w,\n/static/74cae8deb37ee425ce2ccda62a758c27/b4b41/servicegraph.png 2674w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>And we also get an automatic <a href=\"https://istio.io/docs/tasks/telemetry/metrics/using-istio-dashboard/\">Grafana dashboard</a> for this external service, to view data like response codes and latency:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/765399be3d8aab886e29b2007d8a6516/9d68f/grafana.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.773079213817745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABY0lEQVQoz2VRa0/DMAzsl21IIBil7zZpk6aPlQ1auiH+/x87zpkqIfHBOju5u9hxEL88orYdmsbCuh6qaZFkJdKcUSjmhceYGCUZ0pK5IGvR6NrA2hZDW8M0BsHT8xFxXnlCnBbIjEOmGi9MiRmx/1hgxwmuH6H4aBSn3lRQ4i1KEEZE5kEYhojjDDlNc+kqzZEwMj4gtYRWGmVZQVUKZUEeO5YGtti0ogmOx1cobXAa37Fef2DbHjXHMOz0cpl59g3nBo7XoutOGIYJ03RhPsJ1AzS1wpuXG2pygsPhwR9a/uMwnlHTSOmGphYtzfv+5M3kEcdxxVzMhC86CeG5fuJ/WgT7/cGLRbiuN0+UWvB8/sSyXL2BmApHzuZ59SbC09r6Dpev73uHYlipGooLaEzr86q6h++UmxS8TzD5rzDkyQMbT2rrRmobBLvd3m9s29qWbyGbU1pz1I5C++/+77Yl/wUC2NhIhooNPwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"grafana\"\n        title=\"grafana\"\n        src=\"/static/765399be3d8aab886e29b2007d8a6516/b9e4f/grafana.png\"\n        srcset=\"/static/765399be3d8aab886e29b2007d8a6516/cf440/grafana.png 148w,\n/static/765399be3d8aab886e29b2007d8a6516/d2d38/grafana.png 295w,\n/static/765399be3d8aab886e29b2007d8a6516/b9e4f/grafana.png 590w,\n/static/765399be3d8aab886e29b2007d8a6516/f9b6a/grafana.png 885w,\n/static/765399be3d8aab886e29b2007d8a6516/2d849/grafana.png 1180w,\n/static/765399be3d8aab886e29b2007d8a6516/9d68f/grafana.png 3358w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"https://istio.io/docs/tasks/traffic-management/egress/egress-control/#manage-traffic-to-external-services\">See the Istio docs</a> to learn more about managing and securing external services.</p>","frontmatter":{"title":"external services","date":"May 01, 2015"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/external-services/","previous":{"fields":{"slug":"/grpc/"},"frontmatter":{"title":"grpc"}},"next":{"fields":{"slug":"/authorization/"},"frontmatter":{"title":"authorization"}}}}}