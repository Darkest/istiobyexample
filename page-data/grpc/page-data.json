{"componentChunkName":"component---src-templates-example-js","path":"/grpc/","webpackCompilationHash":"4c97b8867ce8cc5e8d2c","result":{"data":{"site":{"siteMetadata":{"title":"Istio By Example","author":"Megan O'Keefe"}},"markdownRemark":{"id":"7d2fbe0d-033e-540b-901c-1848ed2b4902","excerpt":"gRPC is a communication protocol for services, built on HTTP/2. Unlike REST over HTTP/1, which is based on resources, gRPC is based on Service Definitions. You…","html":"<p><a href=\"https://grpc.io/\">gRPC</a> is a communication protocol for services, built on <a href=\"https://www.cncf.io/blog/2018/08/31/grpc-on-http-2-engineering-a-robust-high-performance-protocol/\">HTTP/2</a>. Unlike REST over HTTP/1, which is based on <a href=\"https://en.wikipedia.org/wiki/Representational_state_transfer\">resources</a>, gRPC is based on <a href=\"https://grpc.io/docs/guides/concepts/\">Service Definitions</a>. You specify service definitions in a format called <a href=\"https://developers.google.com/protocol-buffers/\">protocol buffers</a> (“proto”), which can be serialized into an small binary format for transmission.</p>\n<p>With gRPC, you can generate boilerplate code from <code class=\"language-text\">.proto</code> files into <a href=\"https://grpc.io/docs/quickstart/\">multiple programming languages</a>, making gRPC an ideal choice for polyglot microservices.</p>\n<p>While gRPC supports some networking use cases like <a href=\"https://grpc.io/docs/guides/auth/\">TLS</a> and <a href=\"https://grpc.io/blog/loadbalancing/\">client-side load balancing</a>, adding Istio to a gRPC architecture can be useful for collecting telemetry, adding traffic rules, and setting <a href=\"https://istio.io/blog/2018/istio-authorization/#rpc-level-authorization\">RPC-level authorization</a>. Istio can also provide a useful management layer if your traffic is a mix of HTTP, TCP, gRPC, and database protocols, because you can use the same Istio APIs for all traffic types.</p>\n<p><a href=\"https://istio.io/about/feature-stages/#traffic-management\">Istio</a> and its data plane proxy, <a href=\"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_protocols/grpc#arch-overview-grpc\">Envoy</a>, both  support gRPC. Let’s see how to manage gRPC traffic with Istio.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df7cd7dab819fa1db10d469a25e27819/624c6/grpc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.75231676495367%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAJnKAACZygHjkaQiAAABH0lEQVQoz31Sa0+DQBDs//9dmhhjvzUxxBr1Q4XyOrj3k3GPKlJFL5nswc5Ohll22DrT6jpNV1g1Nkd3mSSdB7cOgqoOAQYJiupa4EswpQQZPzk+fM/5C38WrITCaCxaY2CVg3p4h+AGgXo+JtgQr8yPtYQvOAZr0WuDjsAIKQtm0okLtFKj8Ra6aBFeB7BDhbOXeGEt3sYBteboDNVgUe+PEHe3qJ869PSczTDC4rAUEopsM+9gSwG3L8GPHZrUo3Fn+kSBwQ/obAfyBvZYQd/co31uMMb4WzBbbpWeoSkfxdSczV/7GjmDPFEsqiYhg4HEMn8RXCNS6Dmx9OP9AupFW8LLA4IokGLO7sKft/zfb5PHtzY9nyBI2VwN5N4HZfNwqHP3/dwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"grpc\"\n        title=\"grpc\"\n        src=\"/static/df7cd7dab819fa1db10d469a25e27819/b9e4f/grpc.png\"\n        srcset=\"/static/df7cd7dab819fa1db10d469a25e27819/cf440/grpc.png 148w,\n/static/df7cd7dab819fa1db10d469a25e27819/d2d38/grpc.png 295w,\n/static/df7cd7dab819fa1db10d469a25e27819/b9e4f/grpc.png 590w,\n/static/df7cd7dab819fa1db10d469a25e27819/f9b6a/grpc.png 885w,\n/static/df7cd7dab819fa1db10d469a25e27819/2d849/grpc.png 1180w,\n/static/df7cd7dab819fa1db10d469a25e27819/624c6/grpc.png 5935w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>Here, we’re running two gRPC Services, <code class=\"language-text\">client</code> and <code class=\"language-text\">server</code>. <code class=\"language-text\">client</code> makes an RPC call to the <code class=\"language-text\">server</code>’s <code class=\"language-text\">/SayHello</code> function every 2 seconds.</p>\n<p>Adding Istio to gRPC Kubernetes services has one pre-requisite: <a href=\"https://istio.io/docs/setup/kubernetes/additional-setup/requirements/\">labeling</a> your Kubernetes Service ports. The server’s port is labeled as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> server\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> server\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grpc <span class=\"token comment\"># important!</span>\n    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></code></pre></div>\n<p>Once we deploy the app, we can see this traffic between client and server in a <a href=\"https://www.kiali.io/\">service graph</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2cc7e6ef92a4f359ae247e47ece8e510/54f11/kiali.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.11543134872418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABFUlEQVQoz32RS2+DMBCE+f+nXqqqL+XQQxslf6QNVCqoh1g9VEEQASbhERvbGKbGbRVEUUda+bCrb2bXTt/3+K1B43faY4whDEMkSYLdbocoipCmKfI8R9u26LoODkaag4zFOQchBBnN4Ac+yAdBURb2jeMYSik4UkpQSiEa8QfAaoayLO3goCHBjM8okElY17V129M9Gt3gcDygqI5g6oTN+wu2ZAsp5Dml4lh4N7h1r3Bn6t69xuXzBV4j1/btylprCAPjiqGqK1Sn0sA5KMvsbWw6425TS4a1v8Tq7RGr4AnrYIkHbwHvc/MN7P/bYea2+BkX5gxtRAF1nhtMnelHzNUUqjuzUSsgOINqJXSvLWzofQE1AxnLSAsiIQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kiali\"\n        title=\"kiali\"\n        src=\"/static/2cc7e6ef92a4f359ae247e47ece8e510/b9e4f/kiali.png\"\n        srcset=\"/static/2cc7e6ef92a4f359ae247e47ece8e510/cf440/kiali.png 148w,\n/static/2cc7e6ef92a4f359ae247e47ece8e510/d2d38/kiali.png 295w,\n/static/2cc7e6ef92a4f359ae247e47ece8e510/b9e4f/kiali.png 590w,\n/static/2cc7e6ef92a4f359ae247e47ece8e510/f9b6a/kiali.png 885w,\n/static/2cc7e6ef92a4f359ae247e47ece8e510/2d849/kiali.png 1180w,\n/static/2cc7e6ef92a4f359ae247e47ece8e510/54f11/kiali.png 1646w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>We can also view the server’s gRPC traffic metrics in Grafana:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d71c16e00c4e645b843e7b15602d1d3/362b5/server-healthy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.42690058479532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABa0lEQVQozz2Q61KDMBCFeYje24RAyAVCqUArl9ZedKqOOuMP3/9Zjktq/bHs7GbP4dsNxpMZhhj95cl0jtF4itl8CWNTyERBGwulDZS6xfB2n/Vamr/7BMNnNltgsVjR4IKaN7MV44iiCIIiDAWWyxU49QQXmNP7aHwz9Nol85qhDphQMK7Cumyg0gJMaEip4DKH1GY+4kiSscRDvUXdtCjKisg1GBNIiDhfb4jc+jrgpkLef6C7/qDo3xFmDXiyhnQN+ssndNGByZxEa5xejzheD2iPDYzJiDymn2tU1Q6JNL4OWKQRmwIqKyHtxhNGykG5GklaUr/2tRAxbJbD5QXdNKUTMU8khPR0Q16xkAjjFHl9wG7/Ald24NL5dXIS1vWO8sZTDCbdcY/D8wmPfQNLp+A8+if0K/NhZV3CtW9onr+RN1dwu0OoyaTYo718QT88gSUb2DRDf+7QnVts2xoxGd0Ny3Lr81D/AmmByrGFj507AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"server healthy\"\n        title=\"server healthy\"\n        src=\"/static/5d71c16e00c4e645b843e7b15602d1d3/b9e4f/server-healthy.png\"\n        srcset=\"/static/5d71c16e00c4e645b843e7b15602d1d3/cf440/server-healthy.png 148w,\n/static/5d71c16e00c4e645b843e7b15602d1d3/d2d38/server-healthy.png 295w,\n/static/5d71c16e00c4e645b843e7b15602d1d3/b9e4f/server-healthy.png 590w,\n/static/5d71c16e00c4e645b843e7b15602d1d3/f9b6a/server-healthy.png 885w,\n/static/5d71c16e00c4e645b843e7b15602d1d3/2d849/server-healthy.png 1180w,\n/static/5d71c16e00c4e645b843e7b15602d1d3/362b5/server-healthy.png 2394w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>Then, we can apply an Istio traffic rule to inject a 10-second delay <a href=\"https://istio.io/docs/tasks/traffic-management/fault-injection/\">fault</a> into <code class=\"language-text\">server</code>. You might apply this rule in a chaos testing scenario, to test the resiliency of this application.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.istio.io/v1alpha3\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> VirtualService\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> server<span class=\"token punctuation\">-</span>fault\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> server\n  <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">fault</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">delay</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">percentage</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100.0</span>\n        <span class=\"token key atrule\">fixedDelay</span><span class=\"token punctuation\">:</span> 10s\n    <span class=\"token key atrule\">route</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> server\n        <span class=\"token key atrule\">subset</span><span class=\"token punctuation\">:</span> v1</code></pre></div>\n<p>This causes the client RPC to time out (<code class=\"language-text\">Outgoing Request Duration</code>):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30cf39c76b02540fad215f5f0eb110cc/f94bd/grafana-client-fault-inject.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.168067226890756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxElEQVQoz2VS23LaMBD1RwQIxBdsS7ZsyZZlGGwgJOlM2obJ5P8/53R3S3hoH85ovdKey0K0WD5isSLQ+bBY4WG5utd8lkqjaS1M00r93f8Xy9VaeKLvxuP6CZtNgvUmvoN7cRwjTTMkcYKnW0/u1zfcaiFdrhFpXaMoFFrr0PUDus7DEbiu6xZZViBOtsgLDV3X6MOAYTfK6UO419rUyEuFiIcUk5aahpSABYpSSa8gIia1toPfB7TB/Y+BzOx7VMawQ4Mi19huS+S5EjBJWVbQVS1iTMjfbe/QeAsbOgETCbyDC70kiEpVwQ9kuw9wjlQqI8NMus1Lic01E3s/0g/kSMiIMJ9V3dBMA6VqMRVxrJbiMKG1vUARYZJu6RG5apwIdc7LHQ8xWNQYC8czbScCnCRi9lweFdLobYPPX7M8OM07fP6ecX2fcP054et6wss5kHON9x+zvPugu6+PIwLFzjJyaEyDMARqUGRy2lmL6RCE3PseL5cZz+cJx2mHeRqp1yHNcpyOB7y9ksDliCMJ985RMtoh72Sez5gIHDtN2elf+yEQyXwhPNOeWvpP5nLHO93tDtjvZ4zjROm0uCtpj38A6CcjzW7yn7AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"grafana client fault inject\"\n        title=\"grafana client fault inject\"\n        src=\"/static/30cf39c76b02540fad215f5f0eb110cc/b9e4f/grafana-client-fault-inject.png\"\n        srcset=\"/static/30cf39c76b02540fad215f5f0eb110cc/cf440/grafana-client-fault-inject.png 148w,\n/static/30cf39c76b02540fad215f5f0eb110cc/d2d38/grafana-client-fault-inject.png 295w,\n/static/30cf39c76b02540fad215f5f0eb110cc/b9e4f/grafana-client-fault-inject.png 590w,\n/static/30cf39c76b02540fad215f5f0eb110cc/f9b6a/grafana-client-fault-inject.png 885w,\n/static/30cf39c76b02540fad215f5f0eb110cc/2d849/grafana-client-fault-inject.png 1180w,\n/static/30cf39c76b02540fad215f5f0eb110cc/f94bd/grafana-client-fault-inject.png 2380w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>To learn more about gRPC and Istio:</p>\n<ul>\n<li><a href=\"https://istio.io/docs/concepts/traffic-management/#traffic-routing-and-configuration\">Istio docs - Traffic Management</a></li>\n<li><a href=\"https://cloud.google.com/solutions/using-istio-for-internal-load-balancing-of-grpc-services\">Blog post - gRPC + Istio + Cloud Internal Load Balancer</a></li>\n</ul>","frontmatter":{"title":"grpc","date":"May 01, 2015"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/grpc/","previous":{"fields":{"slug":"/databases/"},"frontmatter":{"title":"database traffic"}},"next":null}}}