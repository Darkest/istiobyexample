{"componentChunkName":"component---src-templates-example-js","path":"/load-balancing/","webpackCompilationHash":"4c97b8867ce8cc5e8d2c","result":{"data":{"site":{"siteMetadata":{"title":"Istio By Example","author":"Megan O'Keefe"}},"markdownRemark":{"id":"f6000695-5fac-5e3b-b918-688df63717cd","excerpt":"Kubernetes supports load balancing for inbound traffic. But what about Kubernetes services inside the cluster? When in-cluster services communicate, a load…","html":"<p>Kubernetes supports load balancing for <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer\">inbound</a> traffic. But what about Kubernetes services inside the cluster?</p>\n<p>When in-cluster services <a href=\"https://kubernetes.io/docs/concepts/services-networking/#proxy-mode-iptables\">communicate</a>, a load balancer called kube-proxy <a href=\"https://cloud.google.com/kubernetes-engine/docs/concepts/network-overview#services\">forwards</a> requests to service pods at random. You can use Istio to add more complex load balancing methods, enabled by Envoy.</p>\n<p>Envoy supports multiple load balancing methods, including <a href=\"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#random\">random</a>, <a href=\"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-round-robin\">round-robin</a>, and <a href=\"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-least-request\">least request</a>.</p>\n<p>Let’s see how to use Istio to add <a href=\"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#weighted-least-request\"><strong>least request</strong></a> load balancing for a service called <code class=\"language-text\">payments</code>, which processes all transactions for a web <code class=\"language-text\">frontend</code>. The payments service is backed by three pods.</p>\n<p>In this least request algorithm, the client-side Envoy will first choose two instances at random. Then, it will forward the request to the instance with the fewest number of active requests, to help ensure even load balancing across all instances.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3a984ef8540731916a890e0f734b7f0/b0ee1/least-requests.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.37630208333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAJnKAACZygHjkaQiAAACbklEQVQ4y3WUiU7bQBCG8/7vVKlSaUEQ0hAackAOx7l837fXXydO08ZAVxrtei1/+8/Mv+7RGQ1N05xXTdOJ6xGrgOd6wKHa8lZNcGuDefXSvuv9D/Ae0jQleaFRV2vcuM/a+sohvEP3b1l531m7X8iy5RnYfvwOcIGopmjXde2T50vZO2C7Q7Jng1z3eNsHaMeU4esCJ3ik1wVUKJW2keVTUbQQUHhdERkZ1vaBbOUTzk1G0yO6nfG02AhwIAqVQgioKqLINZLknjydCXBCreJ35Tg9RVjuLf54T6gZrAwHw0uY6RMBPtFTvo0KPVQgcxxSO67MjhxyUa2uoG3yeNGIQ/ATK3rCcAdszT5HR4SUIb16+0Zt7VCWTqGZpBOLynT/Znit7tIoKywx1xa+F7M2PZYHVyIgzioBbubUho46LsmmAt2FpC+y19gCqK/q+6/zthGQjg9EK4eVgMKk4NfKxglTAZ5ggYPyDGovIn+VlP2AsthRFGvKci8lzv5Az3BTd0hfDcKZwc1QZy0HjJbmGdhkCSry2igTjSKdUERTgekC21FVtqxXLfzScTdSok4y8TKOfoIpTdmYKUFcd22Tl0uStE+UfCPNRuK7uai6+DBsfZimN9KAPgtngGbfszHuJO07dtYPymp/Mfa5kyf/pdmzOH4sALdj8qoyZH8qqsdij3uiidTccdh7PpYfs9jPccN+9+pd2+Sz66jqk9pQjP1IMncJX00exjsWh5iH2Qk4Oqf8Edp82Dv/ONrCSJf70mWbeOEx1XySHN52S2x/3AV+ButGmzxWcMfx8IzrT9HMIbPNgOX+K0mm8Rsho4AHrF7EZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"load balancing\"\n        title=\"load balancing\"\n        src=\"/static/c3a984ef8540731916a890e0f734b7f0/b9e4f/least-requests.png\"\n        srcset=\"/static/c3a984ef8540731916a890e0f734b7f0/cf440/least-requests.png 148w,\n/static/c3a984ef8540731916a890e0f734b7f0/d2d38/least-requests.png 295w,\n/static/c3a984ef8540731916a890e0f734b7f0/b9e4f/least-requests.png 590w,\n/static/c3a984ef8540731916a890e0f734b7f0/f9b6a/least-requests.png 885w,\n/static/c3a984ef8540731916a890e0f734b7f0/2d849/least-requests.png 1180w,\n/static/c3a984ef8540731916a890e0f734b7f0/b0ee1/least-requests.png 6144w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>To enable this functionality, we create an Istio <a href=\"https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/\">DestinationRule</a> with a <a href=\"https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#LoadBalancerSettings-SimpleLB\"><code class=\"language-text\">LEAST_CONN</code></a> load balancer:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.istio.io/v1alpha3\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> DestinationRule\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> payments<span class=\"token punctuation\">-</span>load<span class=\"token punctuation\">-</span>balancer\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> payments.prod.svc.cluster.local\n  <span class=\"token key atrule\">trafficPolicy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">loadBalancer</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">simple</span><span class=\"token punctuation\">:</span> LEAST_CONN</code></pre></div>\n<p>Check out the <a href=\"https://istio.io/docs/concepts/traffic-management/#load-balancing-3-subsets\">Istio docs</a> to see how to add multiple load balancing methods for a single host.</p>","frontmatter":{"title":"load balancing","date":"May 01, 2015"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/load-balancing/","previous":{"fields":{"slug":"/path-based-routing/"},"frontmatter":{"title":"path-based routing"}},"next":{"fields":{"slug":"/external-services/"},"frontmatter":{"title":"external services"}}}}}