{"componentChunkName":"component---src-templates-example-js","path":"/response-headers/","webpackCompilationHash":"4c97b8867ce8cc5e8d2c","result":{"data":{"site":{"siteMetadata":{"title":"Istio By Example","author":"Megan O'Keefe"}},"markdownRemark":{"id":"2b5acda6-376e-5a6a-bfa4-3c834d4d378f","excerpt":"With Istio, you can apply traffic rules to route based on HTTP request headers. You can also use Istio to modify response headers. This could be useful if youâ€¦","html":"<p>With Istio, you can apply traffic rules to route based on <a href=\"https://istio.io/docs/tasks/traffic-management/request-routing/#route-based-on-user-identity\">HTTP request headers</a>. You can also use Istio to <a href=\"https://istio.io/docs/reference/config/networking/v1alpha3/virtual-service/#Headers\">modify response headers</a>. This could be useful if you want to strip headers generated by your application, or if you want to add response headers without changing your application code.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c8d7b3515f03624b7f7daeac033d0d40/83aca/headers.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.9443103170771%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAJnKAACZygHjkaQiAAABJklEQVQoz3WSYU+DMBiE9///0RI/7ZOJiTE6F50CZkPQwdiAtkBb+ghkm+K2Sy6XvHl7ucvbiXOOHr2ekyt6mT0mR7P/+J25A4ch55vjN5O/Ceu6xlp7MrOtO1HqTvuxtshCo4RB5g3lrh7UNHacUEqJ1po8zxFliawNd7FjnjhuI8ds5fD3sIgM4rOgiguyb0WRViSrEtEZnwyNMUM6IQRBEKCURCjFawaPKbzv4GEDT50++wrlb1HLhOB+Q+TlrBcZZVaPE/aGVVUN5lrXFKpl6kVMgzmz2ONmteQlFoRxTbPeobyUzUeB2Dd8+Tnl9mB46SBHtJuQJnzDlAkmCWGf0kg91JRdxb5yGgq2kaQSepzw2jcYXfGwa007sLUdu4O19nf/B44MbpvBqBg2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"headers\"\n        title=\"headers\"\n        src=\"/static/c8d7b3515f03624b7f7daeac033d0d40/b9e4f/headers.png\"\n        srcset=\"/static/c8d7b3515f03624b7f7daeac033d0d40/cf440/headers.png 148w,\n/static/c8d7b3515f03624b7f7daeac033d0d40/d2d38/headers.png 295w,\n/static/c8d7b3515f03624b7f7daeac033d0d40/b9e4f/headers.png 590w,\n/static/c8d7b3515f03624b7f7daeac033d0d40/f9b6a/headers.png 885w,\n/static/c8d7b3515f03624b7f7daeac033d0d40/2d849/headers.png 1180w,\n/static/c8d7b3515f03624b7f7daeac033d0d40/83aca/headers.png 6213w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </a>\n    </span></p>\n<p>In this example, we will apply an Istio <a href=\"https://istio.io/docs/concepts/traffic-management/#virtual-services\">VirtualService</a> to add a new header (<code class=\"language-text\">hello:world</code>), then remove the <code class=\"language-text\">set-cookie</code> header. Then, all client requests entering the service mesh through the <code class=\"language-text\">default</code> gateway will receive those modified headers.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.istio.io/v1alpha3\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> VirtualService\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> frontend<span class=\"token punctuation\">-</span>ingress\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span>\n  <span class=\"token key atrule\">gateways</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> frontend<span class=\"token punctuation\">-</span>gateway\n  <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">route</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> frontend\n        <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">headers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">response</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">add</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">hello</span><span class=\"token punctuation\">:</span> world\n          <span class=\"token key atrule\">remove</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token string\">\"set-cookie\"</span></code></pre></div>\n<p>Before we apply the VirtualService, the <code class=\"language-text\">frontend</code> service returns the following response headers:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">HTTP/1.1 200 OK\nset-cookie: shop_session-id=432bef95-0d25-4754-80c8-3904c2e329e9; Max-Age=172800\ndate: Wed, 18 Sep 2019 16:26:01 GMT\ncontent-type: text/html; charset=utf-8\nx-envoy-upstream-service-time: 45\nserver: istio-envoy\ntransfer-encoding: chunked</code></pre></div>\n<p>Then when we <code class=\"language-text\">kubectl apply</code> the VirtualService, we see that Envoy is successfully configured to modify the response headers:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">HTTP/1.1 200 OK\ndate: Wed, 18 Sep 2019 16:26:24 GMT\ncontent-type: text/html; charset=utf-8\nx-envoy-upstream-service-time: 85\nhello: world\nserver: istio-envoy\ntransfer-encoding: chunked</code></pre></div>","frontmatter":{"title":"modify response headers","date":"May 01, 2015"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/response-headers/","previous":null,"next":{"fields":{"slug":"/prometheus/"},"frontmatter":{"title":"bring your own prometheus"}}}}}