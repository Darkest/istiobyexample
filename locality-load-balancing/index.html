<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1242x2148.png"/><link rel="shortcut icon" href="/icons-af785abe7bd1728dacce0fa956daef3f/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/icons-af785abe7bd1728dacce0fa956daef3f/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons-af785abe7bd1728dacce0fa956daef3f/favicon-32x32.png"/><link rel="manifest" href="/icons-af785abe7bd1728dacce0fa956daef3f/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name" content="istiobyexample"/><link rel="apple-touch-icon" sizes="57x57" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title" content="istiobyexample"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-320x460.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-640x920.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-640x1096.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-750x1294.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1182x2208.png"/><meta name="generator" content="Gatsby 2.13.6"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-748x1024.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-768x1004.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1496x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1536x2008.png"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4dcb042e145102b18f03b0234d89e2c0"/><title data-react-helmet="true">locality load balancing | Istio By Example</title><meta data-react-helmet="true" name="description" content="Service Mesh Made Simple"/><meta data-react-helmet="true" property="og:title" content="locality load balancing"/><meta data-react-helmet="true" property="og:description" content="Service Mesh Made Simple"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Megan O&#x27;Keefe"/><meta data-react-helmet="true" name="twitter:title" content="locality load balancing"/><meta data-react-helmet="true" name="twitter:description" content="Service Mesh Made Simple"/><style data-href="/styles.ebfd2c9ebf6196a1e04b.css">@font-face{font-family:Noto Sans;font-style:normal;font-display:swap;font-weight:400;src:local("Noto Sans Regular "),local("Noto Sans-Regular"),url(/static/noto-sans-latin-400-175853ded2a4e2249d37c46ca0ca33c5.woff2) format("woff2"),url(/static/noto-sans-latin-400-e7ccb0aa43af9fb7fae4d1bdc23a099b.woff) format("woff")}@font-face{font-family:Noto Sans;font-style:italic;font-display:swap;font-weight:400;src:local("Noto Sans Regular italic"),local("Noto Sans-Regularitalic"),url(/static/noto-sans-latin-400italic-baa3ec09eb827b4f10593032d1cf2a88.woff2) format("woff2"),url(/static/noto-sans-latin-400italic-14425b1ebbce551302a950b083b6c14e.woff) format("woff")}@font-face{font-family:Noto Sans;font-style:normal;font-display:swap;font-weight:700;src:local("Noto Sans Bold "),local("Noto Sans-Bold"),url(/static/noto-sans-latin-700-43750a193b8ff0b4e929323a72d79301.woff2) format("woff2"),url(/static/noto-sans-latin-700-a8edfe7bbf3b01666adc30c118cc5223.woff) format("woff")}@font-face{font-family:Noto Sans;font-style:italic;font-display:swap;font-weight:700;src:local("Noto Sans Bold italic"),local("Noto Sans-Bolditalic"),url(/static/noto-sans-latin-700italic-bc98820a9bf62004a88ef07e012e3ce3.woff2) format("woff2"),url(/static/noto-sans-latin-700italic-0e19737ff39f96eb1ff99e463fa457a4.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-display:swap;font-weight:400;src:local("Inconsolata Regular "),local("Inconsolata-Regular"),url(/static/inconsolata-latin-400-3b892623781be87c5d9c0baaf120282f.woff2) format("woff2"),url(/static/inconsolata-latin-400-1fe9cc2170c678e8c1f8c5e3535ab848.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-display:swap;font-weight:700;src:local("Inconsolata Bold "),local("Inconsolata-Bold"),url(/static/inconsolata-latin-700-8caa728e7fabd0a8927567953a46e3c2.woff2) format("woff2"),url(/static/inconsolata-latin-700-ca5a6a8c1d3e9185ff972bf537768122.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Inconsolata,Bitstream Vera Sans Mono,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:1.1em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#c1def1}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#c1def1}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:1px .2em;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:green;font-style:italic}.token.namespace{opacity:.7}.token.string{color:#a31515}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.inserted,.token.number,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.language-json .token.boolean,.language-json .token.number,.token.atrule,.token.attr-value,.token.keyword,code[class*=language-css]{color:#00f}.token.function{color:#393a34}.language-autohotkey .token.tag,.token.deleted{color:#9a050f}.language-autohotkey .token.keyword,.token.selector{color:#00009f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.language-json .token.property,.token.class-name{color:#2b91af}.token.selector,.token.tag{color:maroon}.token.attr-name,.token.entity,.token.property,.token.regex{color:red}.token.directive.tag .tag{background:#ff0;color:#393a34}.line-numbers .line-numbers-rows{border-right-color:#a5a5a5}.line-numbers-rows>span:before{color:#2b91af}.line-highlight{background:rgba(193,222,241,.2);background:-webkit-gradient(linear,left top,right top,color-stop(70%,rgba(193,222,241,.2)),to(rgba(221,222,241,0)));background:linear-gradient(90deg,rgba(193,222,241,.2) 70%,rgba(221,222,241,0))}</style><link as="script" rel="preload" href="/component---src-templates-example-js-c0e85791d9a656ba5481.js"/><link as="script" rel="preload" href="/0-09afdea61b0081b11f68.js"/><link as="script" rel="preload" href="/app-f9fb8f03bce81af0938f.js"/><link as="script" rel="preload" href="/styles-8bdc80549fb92234def9.js"/><link as="script" rel="preload" href="/webpack-runtime-49aa56020c2db7faf2ef.js"/><link as="fetch" rel="preload" href="/page-data/locality-load-balancing/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Noto Sans, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/"><img src="/static/logo-6ad259c484273c39f4fc1e88b2ebeae5.png" alt="Logo"/></a></h3></header><main><h2 style="margin-top:0;margin-bottom:0;font-family:Noto Sans, sans-serif">locality load balancing</h2><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem"></p><div style="margin-top:0;margin-bottom:0;font-family:Noto Sans, sans-serif"><p>If youâ€™re running a high-scale, global application, you might be running services in multiple regions. If you have multiple replicas of the same service, you may want to direct client requests to the closest server, in order to minimize latency. You might also want a way to handle failover if one region goes down, and direct traffic to the closest available service.</p>
<p>Istio can help you automatically handle regional traffic using a feature called <strong>locality load balancing.</strong> Letâ€™s see how.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ecbb11b64aa2ac2aa426660e3a034bbb/4072e/default.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 81.34368308351178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAFxGAABcRgEUlENBAAACa0lEQVQ4y32UCW/aQBCF+f//K5XaSOmVhMMlEDD4wvba4HPt/TqLIThRWtAyaD3z5r05PDGG/37MyMH8w3l8P7E/XWfIc8PpZHB3hs3GMJubN0drrzFxbAgCw35veH21MbzzEUBx8OHpNywd+P4Azhy+foFDBFoPSH1vzscmW68Ny+Vgj0dz9rkmnOgWvEON6lMOTYLqFAmZfFPiY4VKz/nPgZZZUQxKrLXH3ruuEZUXwF4LszjkVb+wb/d4vUe9OJD7AZFWHNUNsGk+r3OWcQM0Arg4eDxU98zaOYvomW6qOM09giQSoBtgWZrz/6Fe1xob0tR8BPRZtgs27ZZduYXHnHLqExUpeXauILkFrG6A4+6m6YhhJzV0k5yNXuE2WxbCcnNaE9Qiv44vkqEUpm017uhHhgP4pG0NSl0ySUPui2/cFXf8rH+wKlycRJgaj6XyWB335+bd5m+wqWIMaCkPfGflE3+qGdPmF77eiOSERPV01MR5w7FsibWPU02lCjZGn08a64tkI4Byp/xYUB10vICTR+W4EAV0ojPLBhZ2gOuih8ShtX75Cu16dBthHcbotr8wFGTlyQQnMs1lRBfuqKcZzSKgTmQu82uXoSolKJQNyFxMsqWeRTRzmdelxPVjwH0oazHFFAF9tKN6UjTPMo9J+gngI6ZMMKkknoU004R4HowARXIWSqHzpch+AWlEH1rGHrrML5IHwLqy2Z3B77gWUPHzfYkfS5amRNGwj3UNTS0bIQ9boW6HWVS/AWaZwU5F3Vz8mg7d9URhf2uKXXg7mJaJDRjscOz9sB3DS0Ip3j0fn+uQ/wX/BNYXcPkE6wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="default"
        title="default"
        src="/static/ecbb11b64aa2ac2aa426660e3a034bbb/b9e4f/default.png"
        srcset="/static/ecbb11b64aa2ac2aa426660e3a034bbb/cf440/default.png 148w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/d2d38/default.png 295w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/b9e4f/default.png 590w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/f9b6a/default.png 885w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/2d849/default.png 1180w,
/static/ecbb11b64aa2ac2aa426660e3a034bbb/4072e/default.png 3736w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </a>
    </span></p>
<p>Here, we have two Kubernetes clusters running in two different cloud regions, <code class="language-text">us-central</code> and <code class="language-text">us-east</code>.
The Istio control plane is running in <code class="language-text">us-east</code>, and we have set up <a href="https://github.com/GoogleCloudPlatform/istio-samples/tree/191859c03e73da7e98d451c967cefe24101d1933/multicluster-gke/single-control-plane#demo-multicluster-istio--single-control-plane">single control plane</a> Istio multicluster, so that services running in both clusters can reach each other.</p>
<p>When we started both clusters, the cloud provider added region-specific <code class="language-text">failure-domain</code> labels to the Kubernetes nodes:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">failure-domain.beta.kubernetes.io/region: us-central1
failure-domain.beta.kubernetes.io/zone: us-central1-b</code></pre></div>
<p>Istio will populate requests with these locality labels, allowing Istio to redirect requests to the closest available region.</p>
<p>Both clusters are running an Istio-injected service called <code class="language-text">echo</code>, which prints its location when accessed on port <code class="language-text">80</code>. The central cluster is also running a <code class="language-text">loadgen</code> service that calls <code class="language-text">echo.default.svc.cluster.local:80</code> every second.</p>
<p>By default, the Kubernetes Service behavior is round-robin, between the two <code class="language-text">echo</code> servers on both clusters:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ ðŸŒŠ Hello World! - EAST
$ âœ¨ Hello World! - CENTRAL
$ ðŸŒŠ Hello World! - EAST
$ âœ¨ Hello World! - CENTRAL</code></pre></div>
<p>We can enable locality load balancing by adding an <a href="https://istio.io/docs/reference/config/networking/v1alpha3/destination-rule/#OutlierDetection">outlier detection</a> Istio DestinationRule on the <code class="language-text">east</code> cluster:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.istio.io/v1alpha3
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DestinationRule
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> echo<span class="token punctuation">-</span>outlier<span class="token punctuation">-</span>detection
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> echo.default.svc.cluster.local
  <span class="token key atrule">trafficPolicy</span><span class="token punctuation">:</span>
    <span class="token key atrule">connectionPool</span><span class="token punctuation">:</span>
      <span class="token key atrule">tcp</span><span class="token punctuation">:</span>
        <span class="token key atrule">maxConnections</span><span class="token punctuation">:</span> <span class="token number">1000</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">http2MaxRequests</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token key atrule">maxRequestsPerConnection</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token key atrule">outlierDetection</span><span class="token punctuation">:</span>
      <span class="token key atrule">consecutiveErrors</span><span class="token punctuation">:</span> <span class="token number">7</span>
      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 30s
      <span class="token key atrule">baseEjectionTime</span><span class="token punctuation">:</span> 30s</code></pre></div>
<p>Now, all <code class="language-text">loadgen</code> requests are routed to the closest instance of <code class="language-text">echo</code>, running in <code class="language-text">us-central</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ âœ¨ Hello World! - CENTRAL
$ âœ¨ Hello World! - CENTRAL
$ âœ¨ Hello World! - CENTRAL</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/938519d153fa72945f4be94f2a0f96ec/7570e/locality.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 84.3732590529248%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAFxGAABcRgEUlENBAAACf0lEQVQ4y32UC2/aQBCE8///V6q2Uqo0TQIFlKhgDPh1Z+MXtm+/rm0caNoU6biVb252dnbtGxHhf7/r8zGWf2Im3E3/V1VCkghpJixXwuurcHcntK38dSHLwPOEzUaYz2WIr4lvnNPDNTz9gNUCvt/DyxK+fAJ/C3U9kTIkCENhvR6JVpr8cJABMyW/sQZMWWJdQtIaUmcxWFIS4rzAJAMdTQO7nVAUl1WWQp5rZakQBIJzSni0sK32rE4L/GaL73zqRUy63RO0CZkZCU8n9OLHXlvl6TotOddgXfh8Lm55bB5ZRTNklnGc++zjYPBsIjRmbMrk6cVbGc66jpFwU/r8rJ/xWo9tvkEeLPmDR5DFZOmFsFcx+TntU2wMI2Ff8q4Mea5VXb1k2Sy12zFRvmdbBxzfSpYz4VnVRwr7ptSNG7IUrmRez/nVrXlungYrjvZKoTl3fBqTq3hUqB72QXNSQnHMy0fujp/5mt8yq74riXtTdVHokK7VrdNdW08fNxeFRj1qMovkvpb6glQRVbKHPKIpUswfCjVxFSJFrCvU0hJcHA27CY50biK0AQQ62amHJB7Vt4RmEQyJTPqO0CyR+EVfmTWd71F8DWk3CTZMrxQaVXR4QDRTt/N0DlNOTzqPuxB7fE+4wJmNGpZRPyxpDjX1Dx/jm4vCkzlANEd6hbqqmZa78mm0xW8lq10m6QlXyHGPZBtcsqW839N6ATawZ4X9hFeF+qBll0HPrvdVltjhub320GpPnU56eRixbTpinXod1bTD2CgoihWsuF5tn6DvvNU4VN+jaByM/uUPgvG5Sa+wuhLFx8n5a9PPZdPIh8u5y+T1c/YxbsT8BrhLJFDfRuQGAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="locality"
        title="locality"
        src="/static/938519d153fa72945f4be94f2a0f96ec/b9e4f/locality.png"
        srcset="/static/938519d153fa72945f4be94f2a0f96ec/cf440/locality.png 148w,
/static/938519d153fa72945f4be94f2a0f96ec/d2d38/locality.png 295w,
/static/938519d153fa72945f4be94f2a0f96ec/b9e4f/locality.png 590w,
/static/938519d153fa72945f4be94f2a0f96ec/f9b6a/locality.png 885w,
/static/938519d153fa72945f4be94f2a0f96ec/2d849/locality.png 1180w,
/static/938519d153fa72945f4be94f2a0f96ec/7570e/locality.png 3590w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </a>
    </span></p>
<p>If we delete the <code class="language-text">echo</code> Deployment running in <code class="language-text">us-central</code>, Istio will redirect <code class="language-text">loadgen</code> requests to the <code class="language-text">echo</code> Pod running in <code class="language-text">us-east</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ ðŸŒŠ Hello World! - EAST
$ ðŸŒŠ Hello World! - EAST
$ ðŸŒŠ Hello World! - EAST</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f926ea8027cb05d1c3bece596305f312/caaa1/failover.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 81.25171561899533%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAFxGAABcRgEUlENBAAACdklEQVQ4y3VUaXPbIBT0//9bmem3NI3bRPERy3V0WhfoRqC3fUh2ZKcTNAgEy/KWfWhFRPiu2Knr9Nynb3DL+Mq++p4gBEGWhP2e4LwRDgcLopsFcz8MCWnKGIdwPBKMWTAWthpHgvcBbF4Bdw+sn4DdG/DMbZ4DwzAv0JpQVcD7O8H3CS8vM2HJQbQtfUa5kgIougaxCRGoAIJyCEh+ChR1Dztvo7PkVWUjApTC1A6DVQecz0ukq1oCfhdhpzYIdcCkPrp1jCpLkWiB8kJYFDPJLP22go/LKsBC+NGG+NU+wjUuTtEeoyNRb0OcywylXAitbNu/mnX1oijoMnch9NoIT90jHPWKoPb4IEt0LkfYCdQXwpwXDZ+EdOfuHaGVlPUSsQ4hWOJ22OBv7bLcGHGfIy2GCWhxpJd8IqJP92fCeeOVTRd1cdIbPPxofuChecC6X+PYeNhnMRIKsU1DfHQBirG4y9MpQoElwulAew0zlHirfsJvtjgwWdhtULY1Kmn3VYjzHj3bmvQnHBrOMa1AY8uTNYpUQZtrhCXbL1O26h2m5IRsMiiHv6sGuq2m3W2x6WOahsNxoeWJcQGUm2D0I4hEfiEUZ74CnMl9Bn08otsIqG0ExeGJyZRxllXzK3rmzUKM0Qm9c8bgRMhPOWbFt4SJAxokjO+h/V1g2J2hyhtCbnVlHdyyVIUx43z9w5g1n6tXQI83hLriayB2LOcAcAqNKUtuEuiuvhDSFKHpO8bx/RSMq08gkfH9DL5IZmDT0HRnleLaj+y64W+Dup4T+prY9s7e4ZRhdw3/LMaF0AIsqZT/VztuF9vyHc6O2Z/GNcn/AbYp1e8nLXMJAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="failover"
        title="failover"
        src="/static/f926ea8027cb05d1c3bece596305f312/b9e4f/failover.png"
        srcset="/static/f926ea8027cb05d1c3bece596305f312/cf440/failover.png 148w,
/static/f926ea8027cb05d1c3bece596305f312/d2d38/failover.png 295w,
/static/f926ea8027cb05d1c3bece596305f312/b9e4f/failover.png 590w,
/static/f926ea8027cb05d1c3bece596305f312/f9b6a/failover.png 885w,
/static/f926ea8027cb05d1c3bece596305f312/2d849/failover.png 1180w,
/static/f926ea8027cb05d1c3bece596305f312/caaa1/failover.png 3643w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </a>
    </span></p>
<p>We can also add a percentage-based load balancing rule for mesh-wide traffic, in the global Istio installation settings:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">    localityLbSetting:
      distribute:
      - from: us-central1/*
        to:
          us-central1/*: 20
          us-east1/*: 80</code></pre></div>
<p>Now, all services running in both clusters will share requests 80/20, between <code class="language-text">us-east</code> and <code class="language-text">us-central</code>. No VirtualServices are needed.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ ðŸŒŠ Hello World! - EAST
$ ðŸŒŠ Hello World! - EAST
$ ðŸŒŠ Hello World! - EAST
$ ðŸŒŠ Hello World! - EAST
$ âœ¨ Hello World! - CENTRAL</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a1ecb7dd29b7381cae395f758e69f395/dd1f1/splittraffic.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 84.5488613433266%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAFxGAABcRgEUlENBAAACsElEQVQ4y31Ui1biMBTk/79rPe5DxYUFAUGFQimPJn2mSR+ZnbSg4DkK5zahuZ3OnTuXnrUW330uz79LPef13EUVFqGwSBKL+aKLft9CKfuefH7ArQueR5HFYNDti+LjrNc0Fss3YDQEFnPg8QF4eQZ+3wKrJaC1fWdW10CeW0ynHeBoZOF5tr1XVYDD6kkBhJmCrCIIEyPierQRQn5jk+F4AMrKIVoEgcXxyIoUEMfdmqbd/nCwXAmYRsCmCDAvp1iXHrYIYJYS8XoHBxtJApYdoJRnHe2nQMswIlYv4+Ut36Cv7rCslpiLCeqRRDrcQuZ7yPgDUAhXWrd3wJ22nRxaXwAuCfhb/cTYjPEm57DjGOmjD5EG14CSgHXDXXPVpCtAV7KnAszMBEG5xaJaINrtIDcEg0BMjeuqYxGzZGKdfPIFQ6dRbgzC+sCy7/FX9TGtJpjXcwT1BoEokBiFEhqrMMaP5AZL80qgphW0Y2hbN7jO95zQmiU9k9mNukVmi/aNpqlR8Ds7Bm3TDvUOk6OPX9kd7vXDJdGOoTkxlLyUWcL+b+ALJir6RFM4zTdVGRKe21PJTh735Er+QZl49E0IS6uBVjNMjKRj6EQXW4DNQLJrgYvBHvppTfGoYmubphVPELCKA0C8Mo9r5kGPfZjxDialxUR1Agw3QPCIptij3qygFwmKfz5sSNukFz4kYJ3sYbd9WFZQ+wR82qLyMuSzNeKkOTP0+VbaRUew0ocaSKg7MlTiyjYtoGMoX2CbkrmsZhhAD0MoNwhR3QFWCedJTgk6Y8vJNmOdUdCW3Gp8Adjk9JHksAtGtmLwd3xAmR5ZMhmGIe+ltn2I7oEpGhhd0QYVStNwRj8A2znOXd4pdJdbljVSltt22f1FCdG1/HM4Rm7gz+bNsq9zXbix/A/aIh+xtESi/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="split"
        title="split"
        src="/static/a1ecb7dd29b7381cae395f758e69f395/b9e4f/splittraffic.png"
        srcset="/static/a1ecb7dd29b7381cae395f758e69f395/cf440/splittraffic.png 148w,
/static/a1ecb7dd29b7381cae395f758e69f395/d2d38/splittraffic.png 295w,
/static/a1ecb7dd29b7381cae395f758e69f395/b9e4f/splittraffic.png 590w,
/static/a1ecb7dd29b7381cae395f758e69f395/f9b6a/splittraffic.png 885w,
/static/a1ecb7dd29b7381cae395f758e69f395/2d849/splittraffic.png 1180w,
/static/a1ecb7dd29b7381cae395f758e69f395/dd1f1/splittraffic.png 3469w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </a>
    </span></p>
<p>To learn more about Locality-based load balancing with Istio, see the <a href="https://istio.io/docs/ops/traffic-management/locality-load-balancing/">Istio documentation</a>.</p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li><a rel="next" href="/response-headers/">modify response headers<!-- --> â†’</a></li></ul></main><footer><p style="font-family:Inconsolata, monospace;font-size:1.0em;margin-top:0"> Made with ðŸ’™ by <a href="https://twitter.com/askmeegs">Megan O&#x27;Keefe</a> â€” <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">License</a></p></footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-41949399-6', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/locality-load-balancing/";window.webpackCompilationHash="4c97b8867ce8cc5e8d2c";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f9fb8f03bce81af0938f.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-9cb60e4e97fdee10b895.js"],"component---src-templates-example-js":["/component---src-templates-example-js-c0e85791d9a656ba5481.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c5a7141ca33eb313fa41.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f47e5d778dc6ef485bf7.js"]};/*]]>*/</script><script src="/webpack-runtime-49aa56020c2db7faf2ef.js" async=""></script><script src="/styles-8bdc80549fb92234def9.js" async=""></script><script src="/app-f9fb8f03bce81af0938f.js" async=""></script><script src="/0-09afdea61b0081b11f68.js" async=""></script><script src="/component---src-templates-example-js-c0e85791d9a656ba5481.js" async=""></script></body></html>