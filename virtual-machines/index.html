<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1242x2148.png"/><link rel="shortcut icon" href="/icons-af785abe7bd1728dacce0fa956daef3f/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/icons-af785abe7bd1728dacce0fa956daef3f/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons-af785abe7bd1728dacce0fa956daef3f/favicon-32x32.png"/><link rel="manifest" href="/icons-af785abe7bd1728dacce0fa956daef3f/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name" content="istiobyexample"/><link rel="apple-touch-icon" sizes="57x57" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title" content="istiobyexample"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-320x460.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-640x920.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-640x1096.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-750x1294.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1182x2208.png"/><meta name="generator" content="Gatsby 2.13.6"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-748x1024.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-768x1004.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1496x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/icons-af785abe7bd1728dacce0fa956daef3f/apple-touch-startup-image-1536x2008.png"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4dcb042e145102b18f03b0234d89e2c0"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4dcb042e145102b18f03b0234d89e2c0"/><title data-react-helmet="true">virtual machines | Istio By Example</title><meta data-react-helmet="true" name="description" content="Service Mesh Made Simple"/><meta data-react-helmet="true" property="og:title" content="virtual machines"/><meta data-react-helmet="true" property="og:description" content="Service Mesh Made Simple"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Megan O&#x27;Keefe"/><meta data-react-helmet="true" name="twitter:title" content="virtual machines"/><meta data-react-helmet="true" name="twitter:description" content="Service Mesh Made Simple"/><style data-href="/styles.ebfd2c9ebf6196a1e04b.css">@font-face{font-family:Noto Sans;font-style:normal;font-display:swap;font-weight:400;src:local("Noto Sans Regular "),local("Noto Sans-Regular"),url(/static/noto-sans-latin-400-175853ded2a4e2249d37c46ca0ca33c5.woff2) format("woff2"),url(/static/noto-sans-latin-400-e7ccb0aa43af9fb7fae4d1bdc23a099b.woff) format("woff")}@font-face{font-family:Noto Sans;font-style:italic;font-display:swap;font-weight:400;src:local("Noto Sans Regular italic"),local("Noto Sans-Regularitalic"),url(/static/noto-sans-latin-400italic-baa3ec09eb827b4f10593032d1cf2a88.woff2) format("woff2"),url(/static/noto-sans-latin-400italic-14425b1ebbce551302a950b083b6c14e.woff) format("woff")}@font-face{font-family:Noto Sans;font-style:normal;font-display:swap;font-weight:700;src:local("Noto Sans Bold "),local("Noto Sans-Bold"),url(/static/noto-sans-latin-700-43750a193b8ff0b4e929323a72d79301.woff2) format("woff2"),url(/static/noto-sans-latin-700-a8edfe7bbf3b01666adc30c118cc5223.woff) format("woff")}@font-face{font-family:Noto Sans;font-style:italic;font-display:swap;font-weight:700;src:local("Noto Sans Bold italic"),local("Noto Sans-Bolditalic"),url(/static/noto-sans-latin-700italic-bc98820a9bf62004a88ef07e012e3ce3.woff2) format("woff2"),url(/static/noto-sans-latin-700italic-0e19737ff39f96eb1ff99e463fa457a4.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-display:swap;font-weight:400;src:local("Inconsolata Regular "),local("Inconsolata-Regular"),url(/static/inconsolata-latin-400-3b892623781be87c5d9c0baaf120282f.woff2) format("woff2"),url(/static/inconsolata-latin-400-1fe9cc2170c678e8c1f8c5e3535ab848.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-display:swap;font-weight:700;src:local("Inconsolata Bold "),local("Inconsolata-Bold"),url(/static/inconsolata-latin-700-8caa728e7fabd0a8927567953a46e3c2.woff2) format("woff2"),url(/static/inconsolata-latin-700-ca5a6a8c1d3e9185ff972bf537768122.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Inconsolata,Bitstream Vera Sans Mono,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:1.1em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#c1def1}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#c1def1}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:1px .2em;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:green;font-style:italic}.token.namespace{opacity:.7}.token.string{color:#a31515}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.inserted,.token.number,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.language-json .token.boolean,.language-json .token.number,.token.atrule,.token.attr-value,.token.keyword,code[class*=language-css]{color:#00f}.token.function{color:#393a34}.language-autohotkey .token.tag,.token.deleted{color:#9a050f}.language-autohotkey .token.keyword,.token.selector{color:#00009f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.language-json .token.property,.token.class-name{color:#2b91af}.token.selector,.token.tag{color:maroon}.token.attr-name,.token.entity,.token.property,.token.regex{color:red}.token.directive.tag .tag{background:#ff0;color:#393a34}.line-numbers .line-numbers-rows{border-right-color:#a5a5a5}.line-numbers-rows>span:before{color:#2b91af}.line-highlight{background:rgba(193,222,241,.2);background:-webkit-gradient(linear,left top,right top,color-stop(70%,rgba(193,222,241,.2)),to(rgba(221,222,241,0)));background:linear-gradient(90deg,rgba(193,222,241,.2) 70%,rgba(221,222,241,0))}</style><link as="script" rel="preload" href="/component---src-templates-example-js-c0e85791d9a656ba5481.js"/><link as="script" rel="preload" href="/0-09afdea61b0081b11f68.js"/><link as="script" rel="preload" href="/app-f9fb8f03bce81af0938f.js"/><link as="script" rel="preload" href="/styles-8bdc80549fb92234def9.js"/><link as="script" rel="preload" href="/webpack-runtime-49aa56020c2db7faf2ef.js"/><link as="fetch" rel="preload" href="/page-data/virtual-machines/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Noto Sans, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/"><img src="/static/logo-6ad259c484273c39f4fc1e88b2ebeae5.png" alt="Logo"/></a></h3></header><main><h2 style="margin-top:0;margin-bottom:0;font-family:Noto Sans, sans-serif">virtual machines</h2><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem"></p><div style="margin-top:0;margin-bottom:0;font-family:Noto Sans, sans-serif"><p>Running containerized services in Kubernetes can add lots of benefits, including autoscaling, dependency isolation, and resource optimization. Adding Istio to your Kubernetes environment can radically simplify metrics aggregation and policy management, even if you’re operating lots of containers.</p>
<p>But what about stateful services, or legacy applications are running in virtual machines? Or what if you’re migrating from VMs to containers? Have no fear: you can integrate virtual machines into your Istio service mesh. Let’s see how.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5aa6be26035def23daebd8254eb4399b/76ebb/call-flow.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.20622041920217%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAFxGAABcRgEUlENBAAABlElEQVQoz5WTX3PSQBTF86n9Fn4Vnxyf1AdFHa3FEQqB0kL+GPKfkCwhDdnNzw20Cm1nxDtz5t59yNk9554YbdvyL3T1eH7o6gjd2eCMenKJ+kv+uIwwK/HTDV4i9j1al4SiItpU/IrF/uYT8qP5rpFMkpxZWjDVPRBbjImTYmq4ccHEXZGVNcUnl3Ka4OVbpFRIpWikZKc7smXz0YG8JpcNg2CFr4luVgXDMMMYWQnDRYxpp/ywYsbfHBozoRnHzH4u6ZlL3vVtTCvn6yzi9sOCnZNTffcxvRVf3IjrNKfnhAweCD+PPG69jEtN/P71mNpa0/iCCz0vsi3jucvLVy8Y2HOu3twgxR1brWJoJ3u5oban0vIXmcCYapmd1FTLm2nSoqhoLn12/YBY+3soxZX9lloKaED0HNqlQChJf5ky10SjKNNYY3TGW0GOFeY4YYGvSYJ72FGhvVMnSzk+Kb3tzj+vKLHWgk3dYHTrPxjfHsxv1J5kp3v3wZ+86dc8l88nsTkng88G+4j4JNj/86ecU78BmApPCp+f/YoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="call flow"
        title="call flow"
        src="/static/5aa6be26035def23daebd8254eb4399b/b9e4f/call-flow.png"
        srcset="/static/5aa6be26035def23daebd8254eb4399b/cf440/call-flow.png 148w,
/static/5aa6be26035def23daebd8254eb4399b/d2d38/call-flow.png 295w,
/static/5aa6be26035def23daebd8254eb4399b/b9e4f/call-flow.png 590w,
/static/5aa6be26035def23daebd8254eb4399b/f9b6a/call-flow.png 885w,
/static/5aa6be26035def23daebd8254eb4399b/2d849/call-flow.png 1180w,
/static/5aa6be26035def23daebd8254eb4399b/76ebb/call-flow.png 2958w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </a>
    </span></p>
<p>In this example, we are running a web application for a local library. This web app has multiple backends, all running in a Kubernetes cluster. One of our Kubernetes workloads, <code class="language-text">inventory</code>, talks to a PostgreSQL database, and writes a record for each new book added to the library. This database is running in a virtual machine in another cloud region.</p>
<p>In order to get the full Istio functionality for PostgreSQL, our VM-based database, we need to install the Istio sidecar proxy on the VM, and configure it to talk to the Istio control plane running in the cluster. (Note that this is different from adding external <a href="/external-services">ServiceEntries</a>.) We can add our Postgres database to the mesh with three steps. You can follow along with the commands in the <a href="https://github.com/askmeegs/postgres-library/tree/0241acce9d7e2cede0de8ac9baa1338624f716eb#-postgres-library">demo on GitHub</a>.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3f551cc3dee50629373db7558e62170c/efc60/architecture.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53.55693805788477%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAFxGAABcRgEUlENBAAACFElEQVQoz1WTSZObMBCF/evnjyT3OeeUyjFVs+927PGKWY1AIGQM0pfGrokdqpqGlvT6ve7WCDzGePZ7z/nxF/707f3XS1zf4juLd534Bt9W/06MlPJcXXmurz07+Y5SSDJPvvOUBZQSa9sT8IB3PJyPcdkrXq9wyTMufsSbTBIdGB0Onu/f4MdPT1B5Eu1ZK6hbeIk9byHo8szdNRmm1lhrsU1D3xt6V9LvY0mmGQ2bagGJ5NB9AoUA2c4R5yX6U7Ec79iEFY2pqOuGPFqyWi5IkphNEKOKDxr7wMGujuxHg5RCGCXC7jFxrEvPQvWk2tJOUvRUkcm/Ezld79jr5AiYS8K6UnTtO66b49rgDDjUKtxZVmnFPDH8Sa3ELLtSGBUHkXbRr14LWE7nZL1eCoGStSSvjEg81CfASsNsU/IyT/kMC6K4xN1GVItckjQ8jRX30w/iomFf5ei7Nd12ykzAPlLNbZgTqBw6cwacCuBsq9gWhrubFZ3UL3/Y8j7JGS81N5NfxFXD5nWOfoswLwm/JyGLQlSpmp0Wmd0lw6DkfZWxEHaLUGGfY4pZRla2WHMh2ciagHXLik8BWpVSImWkqReAA9swaVnHhk3cSIf3xKolUuLTDqWOxcPJHDqb4WTmOJTS+R1BuiXIIhodfdWQ4y0ZEtQVR7bD3A1WiRUS/2+wvRPr5Zb0w5UZJvNkQ0w2/AVo6klzRTj/SAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="architecture"
        title="architecture"
        src="/static/3f551cc3dee50629373db7558e62170c/b9e4f/architecture.png"
        srcset="/static/3f551cc3dee50629373db7558e62170c/cf440/architecture.png 148w,
/static/3f551cc3dee50629373db7558e62170c/d2d38/architecture.png 295w,
/static/3f551cc3dee50629373db7558e62170c/b9e4f/architecture.png 590w,
/static/3f551cc3dee50629373db7558e62170c/f9b6a/architecture.png 885w,
/static/3f551cc3dee50629373db7558e62170c/2d849/architecture.png 1180w,
/static/3f551cc3dee50629373db7558e62170c/efc60/architecture.png 3697w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </a>
    </span></p>
<ol>
<li><strong><a href="https://github.com/askmeegs/postgres-library#5-allow-pod-ip-traffic-to-the-vm">Create a firewall rule</a> for pod-to-VM traffic</strong>. This allows traffic from the Kubernetes pod CIDR range directly into our VM-based workload.</li>
<li><strong><a href="https://github.com/askmeegs/postgres-library#6-prepare-a-clusterenv-file-to-send-to-the-vm">Install Istio</a> on the VM</strong>. Copy the service account keys, and the ports the VM service exposes (in this case, PostgreSQL client port <code class="language-text">5432</code>). Update the <code class="language-text">/etc/hosts</code> on the VM to route <code class="language-text">istio.pilot</code> and <code class="language-text">istio.citadel</code> traffic through the Istio IngressGateway running on the cluster. Then, install the Istio sidecar proxy and node agent on the VM. The node agent is responsible for generating client certificates to mount into the sidecar proxy, for mutual TLS authentication. Start the proxy and node agent using <code class="language-text">systemctl</code>.</li>
<li><strong><a href="https://github.com/askmeegs/postgres-library#8-register-the-vm-with-istio-running-on-the-gke-cluster">Register the VM</a> workload with Kubernetes</strong>. We need two Kubernetes resources to add our Postgres database to the mesh. The first is a <code class="language-text">ServiceEntry</code>. This will route the Kubernetes DNS name to the virtual machine IP address. Finally, we need a Kubernetes <code class="language-text">Service</code> to create that DNS entry. This is what will allow our client pod to <a href="https://github.com/askmeegs/postgres-library/blob/master/main.go#L39">start a database connection</a> at <code class="language-text">postgres-1-vm.default.svc.cluster.local</code>. We can use the <code class="language-text">istioctl register</code> command to do this.</li>
</ol>
<p>We can now verify that the Kubernetes-based client can successfully write to the database, by viewing the pod logs:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">postgres-library-6bb956f86b-dt94x server ✅ inserted Fun Home
postgres-library-6bb956f86b-dt94x server ✅ inserted Infinite Jest
postgres-library-6bb956f86b-dt94x server ✅ inserted To the Lighthouse</code></pre></div>
<p>And we can verify that the sidecar proxy running on the VM is intercepting inbound traffic on port <code class="language-text">5432</code>, by viewing the Envoy access logs on the VM.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ tail /var/log/istio/istio.log

[2019-11-14T19:09:00.174Z] &quot;- - -&quot; 0 - &quot;-&quot; &quot;-&quot; 268 441 194 - &quot;-&quot; &quot;-&quot; &quot;-&quot; &quot;-&quot;
&quot;127.0.0.1:5432&quot; inbound|5432|tcp|postgresql-1-vm.default.svc.cluster.local
127.0.0.1:54104 10.128.0.14:5432 10.24.2.23:40190
outbound_.5432_._.postgresql-1-vm.default.svc.cluster.local -</code></pre></div>
<p>We can also see TCP metrics flowing in the Kiali service graph:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/cfd71c3c1d641f6486d87cdbfb40c7b8/1589a/kiali.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.86520376175549%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAuUlEQVQoz61S0Q6CMAzk/z/JT/AVlwWToTi3lylmxhAIjJMOMZOMwINNbm2663Jtl+DPlkxB3/dfH8ahLXFCXhIm54gVO+cGxHn+wbmKmKKY2iWeV1jXNTjnyLIMQggcBy+l9ISu6zzITnmO9MDAGMOlKKCUgrX2VyEd1EbTNKiqCveyhDYjbvYFeVVQWsM8njClxW6fgoszXNuiHUC1qy1TikDkaU5j/Llba3k+4C22uJTYd9iK2LLedxPE51JRirYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="kiali"
        title="kiali"
        src="/static/cfd71c3c1d641f6486d87cdbfb40c7b8/b9e4f/kiali.png"
        srcset="/static/cfd71c3c1d641f6486d87cdbfb40c7b8/cf440/kiali.png 148w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/d2d38/kiali.png 295w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/b9e4f/kiali.png 590w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/f9b6a/kiali.png 885w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/2d849/kiali.png 1180w,
/static/cfd71c3c1d641f6486d87cdbfb40c7b8/1589a/kiali.png 1276w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </a>
    </span></p>
<p>From here, we can use any Istio traffic or security policies to our multi-environment service mesh. For instance, we can encrypt all traffic between the cluster and the VM, by adding a mesh-wide mutual TLS policy:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token string">"authentication.istio.io/v1alpha1"</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> <span class="token string">"MeshPolicy"</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"default"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">peers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">mtls</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token string">"networking.istio.io/v1alpha3"</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> <span class="token string">"DestinationRule"</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"default"</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">"istio-system"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">"*.local"</span>
  <span class="token key atrule">trafficPolicy</span><span class="token punctuation">:</span>
    <span class="token key atrule">tls</span><span class="token punctuation">:</span>
      <span class="token key atrule">mode</span><span class="token punctuation">:</span> ISTIO_MUTUAL</code></pre></div>
<p>To learn more:</p>
<ul>
<li><a href="https://github.com/askmeegs/postgres-library">Run this example in your environment</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/istio-samples/tree/master/mesh-expansion-gce">Try another example</a></li>
<li><a href="https://istio.io/docs/examples/virtual-machines/single-network/">See the Istio documentation</a></li>
</ul></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/secure-ingress/">← <!-- -->secure ingress</a></li><li><a rel="next" href="/locality-load-balancing/">locality load balancing<!-- --> →</a></li></ul></main><footer><p style="font-family:Inconsolata, monospace;font-size:1.0em;margin-top:0"> Made with 💙 by <a href="https://twitter.com/askmeegs">Megan O&#x27;Keefe</a> — <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">License</a></p></footer></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-41949399-6', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/virtual-machines/";window.webpackCompilationHash="4c97b8867ce8cc5e8d2c";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f9fb8f03bce81af0938f.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-9cb60e4e97fdee10b895.js"],"component---src-templates-example-js":["/component---src-templates-example-js-c0e85791d9a656ba5481.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c5a7141ca33eb313fa41.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f47e5d778dc6ef485bf7.js"]};/*]]>*/</script><script src="/webpack-runtime-49aa56020c2db7faf2ef.js" async=""></script><script src="/styles-8bdc80549fb92234def9.js" async=""></script><script src="/app-f9fb8f03bce81af0938f.js" async=""></script><script src="/0-09afdea61b0081b11f68.js" async=""></script><script src="/component---src-templates-example-js-c0e85791d9a656ba5481.js" async=""></script></body></html>